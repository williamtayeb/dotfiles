#!/bin/bash

# Notes options
journals_path="${NOTES}/journals"
ext=".md"

# Check if the notes path exists
if [[ ! -d "$NOTES" ]] ; then
    echo "Notes path $NOTES does not exist"
else
    # If there are no arguments then assume that we are handling journals
    if [[ $# -eq 0 ]] ; then
        # Get the current date
        date=`date +%d-%m-%y`

        # Open notes/journals/date.ext with the default environment editor or vi
        "${EDITOR:-vi}" "${journals_path}/${date}${ext}"
    elif [[ $# -eq 1 ]] ; then
        if [[ $1 == "-l" ]] ; then
            ls "$NOTES"
        elif [[ $1 == "-t" ]] ; then
            tree "$NOTES"
        elif [[ $1 == "-p" ]] ; then
            date_yesterday=`gdate +%d-%m-%y -d "yesterday"`

            "${EDITOR:-vi}" "${journals_path}/${date_yesterday}${ext}"
        else
            "${EDITOR:-vi}" "${NOTES}/${1}${ext}"
        fi
    else
        last_param=${@:$#} # last parameter 
        other_params=${*%${!#}} # all parameters except the last

        path=""

        for directory in $other_params
        do
            path="${path}${directory}/"
        done

        if [[ $last_param == "-l" ]] ; then
            ls "$NOTES/${path}"
        else
            "${EDITOR:-vi}" "${NOTES}/${path}${last_param}${ext}"
        fi
    fi
fi

